{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Marty/OneDrive%20-%20Ualliance%20Services/Documents/sales-crm/src/proxy.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\n\r\nfunction parseJwt(token: string) {\r\n    try {\r\n        // Next.js Edge Runtime supports atob\r\n        const base64Url = token.split('.')[1];\r\n        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\r\n        const jsonPayload = decodeURIComponent(\r\n            atob(base64)\r\n                .split('')\r\n                .map((c) => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))\r\n                .join('')\r\n        );\r\n        return JSON.parse(jsonPayload);\r\n    } catch (e) {\r\n        return null;\r\n    }\r\n}\r\n\r\nexport function proxy(request: NextRequest) {\r\n    const token = request.cookies.get('insurelead_token')?.value;\r\n    const path = request.nextUrl.pathname;\r\n\r\n    // Define public paths that don't require auth\r\n    const isPublicPath = path === '/' || path === '/login' || path === '/forgot-password' || path === '/reset-password';\r\n\r\n    if (!token && !isPublicPath) {\r\n        return NextResponse.redirect(new URL('/login', request.url));\r\n    }\r\n\r\n    if (token) {\r\n        const decoded = parseJwt(token);\r\n\r\n        if (!decoded || !decoded.role) {\r\n            const response = NextResponse.redirect(new URL('/login', request.url));\r\n            response.cookies.delete('insurelead_token');\r\n            return response;\r\n        }\r\n\r\n        const { role } = decoded;\r\n\r\n        // Prevent authenticated users from accessing login pages\r\n        if (isPublicPath && path !== '/') {\r\n            return NextResponse.redirect(new URL(`/${role}`, request.url));\r\n        }\r\n\r\n        // Role-based route protection\r\n        if (path.startsWith('/admin') && role !== 'admin') {\r\n            return NextResponse.redirect(new URL(`/${role}`, request.url));\r\n        }\r\n        if (path.startsWith('/hr') && role !== 'hr') {\r\n            return NextResponse.redirect(new URL(`/${role}`, request.url));\r\n        }\r\n        if (path.startsWith('/sdr') && role !== 'sdr') {\r\n            return NextResponse.redirect(new URL(`/${role}`, request.url));\r\n        }\r\n        if (path.startsWith('/leadgen') && role !== 'leadgen') {\r\n            return NextResponse.redirect(new URL(`/${role}`, request.url));\r\n        }\r\n    }\r\n\r\n    return NextResponse.next();\r\n}\r\n\r\nexport const config = {\r\n    matcher: [\r\n        /*\r\n         * Match all request paths except for the ones starting with:\r\n         * - api (API routes)\r\n         * - _next/static (static files)\r\n         * - _next/image (image optimization files)\r\n         * - favicon.ico (favicon file)\r\n         */\r\n        '/((?!api|_next/static|_next/image|favicon.ico|.*\\\\.(?:png|jpg|jpeg|svg|gif|webp)).*)',\r\n    ],\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAGA,SAAS,SAAS,KAAa;IAC3B,IAAI;QACA,qCAAqC;QACrC,MAAM,YAAY,MAAM,KAAK,CAAC,IAAI,CAAC,EAAE;QACrC,MAAM,SAAS,UAAU,OAAO,CAAC,MAAM,KAAK,OAAO,CAAC,MAAM;QAC1D,MAAM,cAAc,mBAChB,KAAK,QACA,KAAK,CAAC,IACN,GAAG,CAAC,CAAC,IAAM,MAAM,CAAC,OAAO,EAAE,UAAU,CAAC,GAAG,QAAQ,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC,IAC9D,IAAI,CAAC;QAEd,OAAO,KAAK,KAAK,CAAC;IACtB,EAAE,OAAO,GAAG;QACR,OAAO;IACX;AACJ;AAEO,SAAS,MAAM,OAAoB;IACtC,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,qBAAqB;IACvD,MAAM,OAAO,QAAQ,OAAO,CAAC,QAAQ;IAErC,8CAA8C;IAC9C,MAAM,eAAe,SAAS,OAAO,SAAS,YAAY,SAAS,sBAAsB,SAAS;IAElG,IAAI,CAAC,SAAS,CAAC,cAAc;QACzB,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC9D;IAEA,IAAI,OAAO;QACP,MAAM,UAAU,SAAS;QAEzB,IAAI,CAAC,WAAW,CAAC,QAAQ,IAAI,EAAE;YAC3B,MAAM,WAAW,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;YACpE,SAAS,OAAO,CAAC,MAAM,CAAC;YACxB,OAAO;QACX;QAEA,MAAM,EAAE,IAAI,EAAE,GAAG;QAEjB,yDAAyD;QACzD,IAAI,gBAAgB,SAAS,KAAK;YAC9B,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,CAAC,EAAE,MAAM,EAAE,QAAQ,GAAG;QAChE;QAEA,8BAA8B;QAC9B,IAAI,KAAK,UAAU,CAAC,aAAa,SAAS,SAAS;YAC/C,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,CAAC,EAAE,MAAM,EAAE,QAAQ,GAAG;QAChE;QACA,IAAI,KAAK,UAAU,CAAC,UAAU,SAAS,MAAM;YACzC,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,CAAC,EAAE,MAAM,EAAE,QAAQ,GAAG;QAChE;QACA,IAAI,KAAK,UAAU,CAAC,WAAW,SAAS,OAAO;YAC3C,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,CAAC,EAAE,MAAM,EAAE,QAAQ,GAAG;QAChE;QACA,IAAI,KAAK,UAAU,CAAC,eAAe,SAAS,WAAW;YACnD,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,CAAC,EAAE,MAAM,EAAE,QAAQ,GAAG;QAChE;IACJ;IAEA,OAAO,8IAAY,CAAC,IAAI;AAC5B;AAEO,MAAM,SAAS;IAClB,SAAS;QACL;;;;;;SAMC,GACD;KACH;AACL"}}]
}