{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Marty/OneDrive%20-%20Ualliance%20Services/Documents/sales-crm/src/hooks/useSocket.ts"],"sourcesContent":["'use client';\nimport { useEffect, useRef } from 'react';\nimport { io, Socket } from 'socket.io-client';\nimport { useQueryClient } from '@tanstack/react-query';\n\n// Single shared socket instance\nlet socketInstance: Socket | null = null;\n\nfunction getSocket(): Socket {\n  if (!socketInstance) {\n    socketInstance = io(window.location.origin, {\n      path: '/socket.io',\n      transports: ['websocket', 'polling'],\n      reconnectionAttempts: 5,\n      reconnectionDelay: 2000,\n    });\n  }\n  return socketInstance;\n}\n\n/**\n * useSocket â€” connects to Socket.IO and invalidates React Query caches\n * when lead data changes on the server. Call this once per layout component.\n */\nexport function useSocket() {\n  const qc = useQueryClient();\n  const handlerRef = useRef<() => void>();\n\n  useEffect(() => {\n    const socket = getSocket();\n\n    handlerRef.current = () => {\n      qc.invalidateQueries({ queryKey: ['leads'] });\n      qc.invalidateQueries({ queryKey: ['kpis'] });\n      qc.invalidateQueries({ queryKey: ['hr-leads'] });\n      qc.invalidateQueries({ queryKey: ['hr-dashboard'] });\n      qc.invalidateQueries({ queryKey: ['hr-closed-leads'] });\n      qc.invalidateQueries({ queryKey: ['notifications'] });\n      qc.invalidateQueries({ queryKey: ['meetings'] });\n    };\n\n    socket.on('lead:changed', handlerRef.current);\n\n    return () => {\n      if (handlerRef.current) {\n        socket.off('lead:changed', handlerRef.current);\n      }\n    };\n  }, [qc]);\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;;AAHA;;;;AAKA,gCAAgC;AAChC,IAAI,iBAAgC;AAEpC,SAAS;IACP,IAAI,CAAC,gBAAgB;QACnB,iBAAiB,IAAA,wLAAE,EAAC,OAAO,QAAQ,CAAC,MAAM,EAAE;YAC1C,MAAM;YACN,YAAY;gBAAC;gBAAa;aAAU;YACpC,sBAAsB;YACtB,mBAAmB;QACrB;IACF;IACA,OAAO;AACT;AAMO,SAAS;;IACd,MAAM,KAAK,IAAA,2MAAc;IACzB,MAAM,aAAa,IAAA,uKAAM;IAEzB,IAAA,0KAAS;+BAAC;YACR,MAAM,SAAS;YAEf,WAAW,OAAO;uCAAG;oBACnB,GAAG,iBAAiB,CAAC;wBAAE,UAAU;4BAAC;yBAAQ;oBAAC;oBAC3C,GAAG,iBAAiB,CAAC;wBAAE,UAAU;4BAAC;yBAAO;oBAAC;oBAC1C,GAAG,iBAAiB,CAAC;wBAAE,UAAU;4BAAC;yBAAW;oBAAC;oBAC9C,GAAG,iBAAiB,CAAC;wBAAE,UAAU;4BAAC;yBAAe;oBAAC;oBAClD,GAAG,iBAAiB,CAAC;wBAAE,UAAU;4BAAC;yBAAkB;oBAAC;oBACrD,GAAG,iBAAiB,CAAC;wBAAE,UAAU;4BAAC;yBAAgB;oBAAC;oBACnD,GAAG,iBAAiB,CAAC;wBAAE,UAAU;4BAAC;yBAAW;oBAAC;gBAChD;;YAEA,OAAO,EAAE,CAAC,gBAAgB,WAAW,OAAO;YAE5C;uCAAO;oBACL,IAAI,WAAW,OAAO,EAAE;wBACtB,OAAO,GAAG,CAAC,gBAAgB,WAAW,OAAO;oBAC/C;gBACF;;QACF;8BAAG;QAAC;KAAG;AACT;GAzBgB;;QACH,2MAAc"}},
    {"offset": {"line": 103, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Marty/OneDrive%20-%20Ualliance%20Services/Documents/sales-crm/src/features/hr/layout/HRLayout.tsx"],"sourcesContent":["'use client';\r\nimport { useRouter, usePathname } from 'next/navigation';\r\nimport { ReactNode, useEffect, useState } from 'react';\r\nimport Link from 'next/link';\r\nimport {\r\n  ClipboardCheck, Home, LogOut, Menu, StickyNote, Users, X, Zap, FileText,\r\n} from 'lucide-react';\r\nimport { useAuth } from '@/features/auth/context/AuthContext';\r\nimport { useSocket } from '@/hooks/useSocket';\r\n\r\nconst hrNavItems = [\r\n  { icon: Home, label: 'Dashboard', path: '/hr' },\r\n  { icon: Users, label: 'Lead Tracker', path: '/hr/leads' },\r\n  { icon: ClipboardCheck, label: 'Closed Leads', path: '/hr/closed-leads' },\r\n  { icon: StickyNote, label: 'My Notes', path: '/hr/notes' },\r\n];\r\n\r\nexport default function HRLayout({ children }: { children: ReactNode }) {\r\n  const pathname = usePathname() ?? '';\r\n  const router = useRouter();\r\n  const { user, logout } = useAuth();\r\n  const [sidebarOpen, setSidebarOpen] = useState(false);\r\n  const [authBootstrapped, setAuthBootstrapped] = useState(false);\r\n  const [isAdminImpersonating, setIsAdminImpersonating] = useState(false);\r\n  useSocket();\r\n\r\n  useEffect(() => {\r\n    const hasStoredToken = typeof window !== 'undefined' && !!localStorage.getItem('insurelead_token');\r\n    if (!user && !hasStoredToken) {\r\n      router.replace('/login');\r\n      return;\r\n    }\r\n    setAuthBootstrapped(true);\r\n\r\n    if (typeof window !== 'undefined') {\r\n      setIsAdminImpersonating(!!localStorage.getItem('insurelead_admin_token'));\r\n    }\r\n  }, [user, router]);\r\n\r\n  const handleReturnToAdmin = () => {\r\n    const adminToken = localStorage.getItem('insurelead_admin_token');\r\n    const adminUser = localStorage.getItem('insurelead_admin_user');\r\n\r\n    if (adminToken && adminUser) {\r\n      localStorage.setItem('insurelead_token', adminToken);\r\n      localStorage.setItem('insurelead_user', adminUser);\r\n      document.cookie = `insurelead_token=${adminToken}; path=/; max-age=604800; samesite=lax`;\r\n\r\n      localStorage.removeItem('insurelead_admin_token');\r\n      localStorage.removeItem('insurelead_admin_user');\r\n\r\n      window.location.href = '/admin';\r\n    }\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    logout();\r\n  };\r\n\r\n  if (!user || !authBootstrapped) {\r\n    return (\r\n      <div className=\"flex h-screen items-center justify-center bg-background\">\r\n        <p className=\"text-sm text-muted-foreground\">Loading workspace...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex h-screen bg-background\">\r\n      {/* Sidebar */}\r\n      <aside\r\n        className={`fixed inset-y-0 left-0 z-50 w-64 transform bg-sidebar border-r border-sidebar-border flex flex-col transition-transform lg:relative lg:translate-x-0 ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'\r\n          }`}\r\n      >\r\n        <div className=\"absolute inset-0 bg-gradient-to-b from-white/[0.03] via-transparent to-black/[0.05] pointer-events-none\" />\r\n\r\n        <div className=\"relative flex h-16 items-center gap-2.5 px-6 border-b border-sidebar-border\">\r\n          <img src=\"/team-united-logo.png\" alt=\"Team United\" className=\"h-8\" />\r\n          <span className=\"text-lg font-bold text-sidebar-foreground tracking-tight\">TeamUnited</span>\r\n          <button className=\"ml-auto lg:hidden text-sidebar-foreground hover:text-white transition-colors\" onClick={() => setSidebarOpen(false)}>\r\n            <X className=\"h-5 w-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        {/* HR badge */}\r\n        <div className=\"relative px-4 py-3 border-b border-sidebar-border\">\r\n          <div className=\"flex items-center gap-2 rounded-lg bg-gradient-to-r from-emerald-500/15 to-emerald-500/5 border border-emerald-500/20 px-3 py-2 backdrop-blur-sm\">\r\n            <FileText className=\"h-4 w-4 text-emerald-400\" />\r\n            <span className=\"text-sm font-semibold text-emerald-400\">HR Panel</span>\r\n          </div>\r\n        </div>\r\n\r\n        <nav className=\"relative flex-1 px-3 py-4 space-y-0.5 overflow-y-auto\">\r\n          {hrNavItems.map((item) => {\r\n            const active =\r\n              pathname === item.path ||\r\n              (item.path !== '/hr' && pathname.startsWith(item.path));\r\n            return (\r\n              <Link\r\n                key={item.path}\r\n                href={item.path}\r\n                onClick={() => setSidebarOpen(false)}\r\n                className={`relative flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium transition-all duration-200 group ${active\r\n                  ? 'bg-sidebar-accent text-sidebar-primary shadow-[inset_0_0_0_1px_hsl(var(--sidebar-primary)/0.15)]'\r\n                  : 'text-sidebar-foreground/75 hover:bg-sidebar-accent/60 hover:text-sidebar-accent-foreground'\r\n                  }`}\r\n              >\r\n                {active && (\r\n                  <div className=\"absolute left-0 top-1/2 -translate-y-1/2 w-[3px] h-5 rounded-r-full bg-sidebar-primary shadow-[0_0_8px_hsl(var(--sidebar-primary)/0.5)]\" />\r\n                )}\r\n                <item.icon className={`h-4 w-4 transition-transform duration-200 ${active ? 'text-sidebar-primary' : 'group-hover:scale-110'}`} />\r\n                {item.label}\r\n              </Link>\r\n            );\r\n          })}\r\n        </nav>\r\n\r\n        <div className=\"relative p-3 border-t border-sidebar-border\">\r\n          <button\r\n            onClick={handleLogout}\r\n            className=\"flex w-full items-center gap-3 rounded-lg px-3 py-2.5 text-sm text-sidebar-foreground/70 hover:bg-destructive/10 hover:text-destructive transition-all duration-200\"\r\n          >\r\n            <LogOut className=\"h-4 w-4\" />\r\n            Sign Out\r\n          </button>\r\n        </div>\r\n      </aside>\r\n\r\n      {/* Overlay */}\r\n      {sidebarOpen && (\r\n        <div className=\"fixed inset-0 z-40 bg-foreground/20 lg:hidden\" onClick={() => setSidebarOpen(false)} />\r\n      )}\r\n\r\n      {/* Main */}\r\n      <div className=\"flex-1 flex flex-col overflow-hidden\">\r\n        <header className=\"relative z-20 flex h-16 items-center justify-between border-b border-border/50 px-6 bg-card/80 backdrop-blur-md shadow-[0_1px_3px_hsl(var(--foreground)/0.04)]\">\r\n          <button className=\"lg:hidden text-foreground\" onClick={() => setSidebarOpen(true)}>\r\n            <Menu className=\"h-5 w-5\" />\r\n          </button>\r\n          <div className=\"hidden lg:block\" />\r\n          <div className=\"flex items-center gap-3\">\r\n            {isAdminImpersonating && (\r\n              <button\r\n                onClick={handleReturnToAdmin}\r\n                className=\"hidden sm:flex items-center gap-2 rounded-lg px-3 py-1.5 border border-primary/20 bg-primary/5 hover:bg-primary/10 text-primary transition-colors text-sm font-medium mr-2\"\r\n              >\r\n                <Users className=\"h-4 w-4\" />\r\n                Return to Admin\r\n              </button>\r\n            )}\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-br from-emerald-500 to-emerald-600 text-white text-sm font-medium ring-2 ring-emerald-500/20\">\r\n                {user?.avatar || 'HR'}\r\n              </div>\r\n              <div className=\"hidden sm:block\">\r\n                <p className=\"text-sm font-medium text-foreground\">{user?.name || 'HR Manager'}</p>\r\n                <p className=\"text-xs text-muted-foreground\">HR</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </header>\r\n        <main className=\"flex-1 overflow-y-auto p-3 sm:p-6\">{children}</main>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}